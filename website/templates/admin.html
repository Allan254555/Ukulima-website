<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shop Admin Panel</title>
    <style>
        body { font-family: Arial; margin: 2rem; }
        .product, .category { border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; }
        input, select, textarea { margin: 5px 0; display: block; width: 300px; }
    </style>
</head>
<body>

<h1>Product List</h1>
<div id="product-list"></div>
<button onclick="loadProducts(currentPage - 1)" id="prev">Previous</button>
<button onclick="loadProducts(currentPage + 1)" id="next">Next</button>

<hr>

<h2>Add Category</h2>
<form id="category-form">
    <input type="text" name="name" placeholder="Category Name" required>
    <input type="file" name="file" accept="image/*" required>
    <button type="submit">Add Category</button>
</form>
<div id="category-result"></div>

<hr>

<h2>Add Product</h2>
<form id="product-form">
    <input type="text" name="productName" placeholder="Product Name" required>
    <input type="number" name="price" placeholder="Price" required>
    <input type="number" name="quantity" placeholder="Quantity" required>
    <textarea name="productDescription" placeholder="Description"></textarea>
    <select name="categoryId" id="category-select" required></select>
    <input type="file" name="file" accept="image/*" required>
    <button type="submit">Add Product</button>
</form>
<div id="product-result"></div>

<script>
let currentPage = 1;

function loadProducts(page = 1) {
    fetch(`/api/products?page=${page}`)
        .then(res => res.json())
        .then(data => {
            if (!data.products.length) return;
            currentPage = page;
            const container = document.getElementById("product-list");
            container.innerHTML = "";
            data.products.forEach(p => {
                const div = document.createElement("div");
                div.className = "product";
                div.innerHTML = `
                    <h3>${p.productName} (${p.status})</h3>
                    <p>Price: $${p.price} | Quantity: ${p.quantity}</p>
                    <p>${p.productDescription}</p>
                    <p>Category: ${p.categoryName}</p>
                    <img src="/static/uploads/${p.image_url}" alt="${p.productName}" width="150">

                `;
                container.appendChild(div);
            });

            document.getElementById("prev").disabled = !data.has_prev;
            document.getElementById("next").disabled = !data.has_next;
        });
}

document.getElementById("category-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    fetch("/api/staff/categories", {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("category-result").textContent = data.msg || data.error;
        loadCategories(); // refresh dropdown
    });
});

function loadCategories() {
    fetch("/api/categories")
        .then(res => res.json())
        .then(data => {
            const select = document.getElementById("category-select");
            select.innerHTML = "";
            data.categories.forEach(cat => {
                const option = document.createElement("option");
                option.value = cat.id;
                option.textContent = cat.name;
                select.appendChild(option);
            });
        });
}

document.getElementById("product-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    fetch("/api/staff/products", {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("product-result").textContent = data.msg || data.error;
        loadProducts(currentPage); // refresh products
    });
});

window.onload = function() {
    loadCategories();
    loadProducts();
};
</script>

</body>
</html>
